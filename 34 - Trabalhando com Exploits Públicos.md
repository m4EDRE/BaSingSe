
# Introdução

Muitas vezes podemos enfrentar cenários em que aplicações a serem exploradas não terão um exploit já reconhecido dentro do Metasploit. Nem por isso devemos encerrar as verificações, ou se deixar por vencido em casos como esse.

Para resolver isso deve ser feita uma análise na internet e em repositórios públicos na busca de `exploits` que possam servir para o caso especifico.

Veja abaixo alguns problemas que podemos enfrentar na busca por exploits públicos:

- Exploits públicos `não` compartilham de uma `linguagem de programação única`, sendo necessário o entendimento de várias linguagens dependendo do caso.
- Muitas vezes exploits públicos podem conter `shellcodes maliciosos` e escondidos dentro de si, isso pode ocasionar um comprometimento do próprio atacante, gerando o famoso tiro pela culatra.
- Dependo do exploit podem ser necessárias muitas mudanças para que ele rode na máquina do atacante, tendo em vista que ele pode ter sido programado e pensado em `OS diferentes, de versões diferentes`


----




# Cuidado com Exploits

Como visto no módulo anterior um cuidado que se deve ter ao usar exploits públicos é a possibilidade de termos `shellcodes maliciosos` instalados dentro do código, dessa forma gerando o comprometimento do atacante.

Com isso sempre realize as seguintes verificações antes de rodar um exploit público:

- Analise todos os shellcodes presentes no código, independentemente de seu formato (hex,base64 e etc)
- Análise todos os hexadecimais do código, traduzindo e tendo certeza de todos!
- Análise as funções sendo chamadas e sua finalidade, muitas vezes é possível que funções contraditórias estejam presentes levantando um indicio do risco.
- Analisar fluxo de execução do código, pode ser que o fluxo não faça sentido em sua execução servindo apenas para ludibriar o atacante em relação ao verdadeiro sentido do código.



-----






# Bases de Exploits Online

A seguir estão algumas bases muito utilizadas para buscar exploits on-line:

- [exploit-db.com](http://exploit-db.com) : Principal base de exploits públicos permitindo uma série de filtros na pesquisa
- [packetstormsecurity.com](http://packetstormsecurity.com) : Site interessante bem antigo contendo diversos exploits
- [securityfocus.com](http://securityfocus.com) : + 1 site com diversos exploits
- [cve.mitre.org](http://cve.mitre.org) : Site que organiza a documentação de diversas vulnerabilidades encontradas
- [google.com](http://google.com) : Sempre valida uma pesquisa por exploits no google



-----




# Searchsploit e Dicas de Livros

- `searchsploit <item>` : Programa que fornece uma base de dados a ser consultada em relação a exploits conhecidos, ferramenta nativa Kali

### Dicas de livro:

- the Shellcoders HandBook
- Grayhat Hacking
- Penetration testing with Shellcode
    - - Básico deles
    - - Melhor leitura



-----




# Corrigindo exploits públicos

Para encerrar essa página finalizaremos aglomerando um passo a passo com verificações que devem ser feitas na maioria dos casos em que se for utilizar um exploit público.

### Passo a passo para adaptar exploit público

1. Comece abrindo o código baixado e altere os seguintes itens para o seu caso
    1. IP e porta de retorno
    2. DLLs a serem utilizadas
    3. Entenda e altere o shellcode caso necessário
    4. Content Length
    5. Demais itens caso necessário
2. Abra o software em um LAB e com o GDB ou Debugger comece a estudar o funcionamento do serviço, já verifique as DLLs a serem usadas pelo programa.
3. Siga para os testes padrões de Buffer Overflow como:
    1. Envio de dados
    2. Como os registradores recebem conteúdo e seus bytes referentes
    3. Encontre o JMP ESP
4. Após correção realize mais um teste e faça os demais ajustes de acordo com as mudanças do seu OS ou demais diferenças observadas via debug no Debugger
5. Para finalizar corrija e altere o Shellcode do programa, dessa forma adaptando ele para que ele funcione em seu ataque, retornando uma shell para seu endpoint ou explorando a vuln de forma adaptada.